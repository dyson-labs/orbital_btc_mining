<!doctype html>
<html>
<head>
    <title>BTC Mining Satellite Configurator</title>
    <style>
        label { font-weight: bold; }
        .slider-label { margin-bottom: 4px; display: block; }
        .slider-value { display: inline-block; min-width: 40px; }
    </style>
</head>
<body>
    <h1>Configure Your Satellite Mission</h1>
    <form id="configForm" onsubmit="return false;">
        <label for="orbit">Select Orbit:</label>
        <select id="orbit" name="orbit" onchange="updateOrbit()">
            {% for value, label in orbits %}
                <option value="{{ value }}">{{ label }}</option>
            {% endfor %}
        </select>
        <br><br>
        <label for="launch">Select Launch Vehicle:</label>
        <select id="launch" name="launch">
            {% for value, label in launches %}
                <option value="{{ value }}">{{ label }}</option>
            {% endfor %}
        </select>
        <br><br>
        <label for="regime">Select Launch Regime:</label>
        <select id="regime" name="regime">
            {% for value, label in regimes %}
                <option value="{{ value }}">{{ label }}</option>
            {% endfor %}
        </select>
        <br><br>
        <label for="sat_class">Select Satellite Class:</label>
        <select id="sat_class" name="sat_class">
            {% for value, label in sat_classes %}
                <option value="{{ value }}">{{ label }}</option>
            {% endfor %}
        </select>
        <br><br>
        <span class="slider-label">Bitcoin Price Appreciation (%/yr): <span id="btc_appreciation_val">0</span>%</span>
        <input type="range" id="btc_appreciation" name="btc_appreciation" min="-50" max="50" value="0" step="5" oninput="document.getElementById('btc_appreciation_val').innerText=this.value;">
        <br><br>
        <span class="slider-label">Bitcoin Network Hash Growth (%/yr): <span id="btc_hash_growth_val">0</span>%</span>
        <input type="range" id="btc_hash_growth" name="btc_hash_growth" min="-50" max="50" value="0" step="5" oninput="document.getElementById('btc_hash_growth_val').innerText=this.value;">
        <br><br>
        <button type="button" onclick="simulate()">Simulate</button>
        <div id="loading" style="display:none; color: #0a0; font-weight: bold; margin: 20px 0;">
            Simulating... Please wait.
        </div>
    </form>
    <div id="results" style="margin-top: 2em; color: green;"></div>
    <div id="visuals" style="margin-top: 1em;">
        <img id="orbit_img" alt="Orbit plot" style="max-width: 400px; display:none;" />
        <img id="thermal_img" alt="Thermal plot" style="max-width: 400px; display:none;" />
    </div>
    <pre id="rf_summary" style="background:#f5f5f5; padding:10px;"></pre>
    <script>
        function updateOrbit() {
            const idx = document.getElementById('orbit').value;
            fetch(`/orbit_image/${idx}`)
                .then(res => res.blob())
                .then(blob => {
                    const url = URL.createObjectURL(blob);
                    const img = document.getElementById('orbit_img');
                    img.src = url;
                    img.style.display = 'block';
                });
        }

        function simulate() {
            document.getElementById('loading').style.display = 'block';
            document.getElementById('results').innerText = '';
            document.getElementById('orbit_img').style.display = 'none';
            document.getElementById('thermal_img').style.display = 'none';
            document.getElementById('rf_summary').innerText = '';
            const data = {
                orbit: document.getElementById('orbit').value,
                launch: document.getElementById('launch').value,
                regime: document.getElementById('regime').value,
                sat_class: document.getElementById('sat_class').value,
                btc_appreciation: document.getElementById('btc_appreciation').value,
                btc_hash_growth: document.getElementById('btc_hash_growth').value
            };
            fetch('/api/simulate', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(data)
            })
            .then(res => res.json())
            .then(res => {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('results').innerText = 'Orbit: ' + res.orbit;
                if (res.orbit_plot) {
                    document.getElementById('orbit_img').src = 'data:image/png;base64,' + res.orbit_plot;
                    document.getElementById('orbit_img').style.display = 'block';
                }
                if (res.thermal_plot) {
                    document.getElementById('thermal_img').src = 'data:image/png;base64,' + res.thermal_plot;
                    document.getElementById('thermal_img').style.display = 'block';
                }
                document.getElementById('rf_summary').innerText = JSON.stringify(res.rf_summary, null, 2);
            })
            .catch(e => {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('results').innerText = "Error: " + e;
            });
        }
        window.onload = updateOrbit;
    </script>
</body>
</html>
